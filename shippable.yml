language: php

php: 
  - 5.4

env:
  global:
    - AWS_DEFAULT_REGION=us-east-1 AWS_STACK=6a1cdac0-6e04-4bdc-a71d-65a9445c4aae AWS_APP_ID=48129342-38ba-43dd-b85a-596f8a1e0443
    - AWS_ACCESS_KEY_ID=AKIAIEGCPRP3RYDLYADQ
    - secure: d9KdasPrp362eIhLNUrL+pdiX1C+Nvga+tDiIC/Pn/jRmyXRMlcvSKRWEofr/JaGMDTlQN8sB+kAZ9Xi3LWFeGI/Z7YBG4ba0pciE/sfVAriklEom7F2/kI55l/1P6XqMG6OvHUsmdORTy6v/xm/CDsrofsLtFqujfKZuHEIADozO1cbNOTAkGuWBMylptRmfmEbo51cqu8Zx/L4DjpjRIAg+xdKTHGWraMC/vWz1nFHV9kXXx8f3wwDu/7zrIo8zaXhMWz70NwvgmzBbnagm0NvLJ/fdkcucsMZdED3lSlJMN/UI2DJj1a0u27WvSZrn/ggGhl20AbzNTmaZUFiXw==
    
before_script: 
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - mysql -e 'create database if not exists test;'
  - sudo cp test-config/opsworks.php /var/www/html/subwaysymphony_live/html/opsworks.php
      
script:
  - phpunit  --log-junit shippable/testresults/junit.xml --coverage-xml shippable/codecoverage test.php

after_success:
  - virtualenv ve && source ve/bin/activate && pip install awscli
  - aws opsworks create-deployment --stack-id $AWS_STACK --app-id $AWS_APP_ID --command '{"Name":"deploy"}'

