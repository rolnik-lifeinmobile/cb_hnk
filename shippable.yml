language: php

php: 
  - 5.4

env:
  global:
    - AWS_DEFAULT_REGION=us-east-1 AWS_STACK=6a1cdac0-6e04-4bdc-a71d-65a9445c4aae AWS_APP_ID=48129342-38ba-43dd-b85a-596f8a1e0443
    - AWS_ACCESS_KEY_ID=AKIAIEGCPRP3RYDLYADQ
    - secure: AAAAB3NzaC1yc2EAAAADAQABAAABAQCrUYWlKEtNMPYrm7ysbIuiW9MB3vs7j3rTmiSMXpWi+fHcnCtmFm7EEizGuYNRqPKVK+4JparODC65wOJA7roHrqV6UW7GvAVRz1czhiy349I6hxupry4+Gf7jjcVAYNN/k44WgLHQlVvs/LCIb1bi/XztHvHJ1k7rMlVK1oghdkerhjx/NR+tfKBRXJPlOZrEv1ScsvY7WIhbDGEAzrlK1rPa6Tj5tq4DpAatHHodM16yvMCO8MOA05NsTBJHbKOYWzHg+elNEgikPxsSEHFfUsIQQTHT8eiskqjZZPPFu2zlij4tZjEIf5dtsXTCZfGHYrf2MFj+yoGaXueBmTEV
    
before_script: 
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - mysql -e 'create database if not exists test;'
  - sudo cp test-config/opsworks.php /var/www/html/subwaysymphony_live/html/opsworks.php

script:
  - phpunit  --log-junit shippable/testresults/junit.xml --coverage-xml shippable/codecoverage test.php

after_success:
  - virtualenv ve && source ve/bin/activate && pip install awscli
  - aws opsworks create-deployment --stack-id $AWS_STACK --app-id $AWS_APP_ID --command '{"Name":"deploy"}'

